double a[M][N][P];
double b[M][N][P];
double W[M][N][P][343];

for(int k=3; k < M-3; k++){
for(int j=3; j < N-3; j++){
for(int i=3; i < P-3; i++){
b[k][j][i] = W[k][j][i][0] * a[k][j][i]
+ W[k][j][i][1] * a[k-3][j-3][i-3]
+ W[k][j][i][2] * a[k-2][j-3][i-3]
+ W[k][j][i][3] * a[k-1][j-3][i-3]
+ W[k][j][i][4] * a[k][j-3][i-3]
+ W[k][j][i][5] * a[k+1][j-3][i-3]
+ W[k][j][i][6] * a[k+2][j-3][i-3]
+ W[k][j][i][7] * a[k+3][j-3][i-3]
+ W[k][j][i][8] * a[k-3][j-2][i-3]
+ W[k][j][i][9] * a[k-2][j-2][i-3]
+ W[k][j][i][10] * a[k-1][j-2][i-3]
+ W[k][j][i][11] * a[k][j-2][i-3]
+ W[k][j][i][12] * a[k+1][j-2][i-3]
+ W[k][j][i][13] * a[k+2][j-2][i-3]
+ W[k][j][i][14] * a[k+3][j-2][i-3]
+ W[k][j][i][15] * a[k-3][j-1][i-3]
+ W[k][j][i][16] * a[k-2][j-1][i-3]
+ W[k][j][i][17] * a[k-1][j-1][i-3]
+ W[k][j][i][18] * a[k][j-1][i-3]
+ W[k][j][i][19] * a[k+1][j-1][i-3]
+ W[k][j][i][20] * a[k+2][j-1][i-3]
+ W[k][j][i][21] * a[k+3][j-1][i-3]
+ W[k][j][i][22] * a[k-3][j][i-3]
+ W[k][j][i][23] * a[k-2][j][i-3]
+ W[k][j][i][24] * a[k-1][j][i-3]
+ W[k][j][i][25] * a[k][j][i-3]
+ W[k][j][i][26] * a[k+1][j][i-3]
+ W[k][j][i][27] * a[k+2][j][i-3]
+ W[k][j][i][28] * a[k+3][j][i-3]
+ W[k][j][i][29] * a[k-3][j+1][i-3]
+ W[k][j][i][30] * a[k-2][j+1][i-3]
+ W[k][j][i][31] * a[k-1][j+1][i-3]
+ W[k][j][i][32] * a[k][j+1][i-3]
+ W[k][j][i][33] * a[k+1][j+1][i-3]
+ W[k][j][i][34] * a[k+2][j+1][i-3]
+ W[k][j][i][35] * a[k+3][j+1][i-3]
+ W[k][j][i][36] * a[k-3][j+2][i-3]
+ W[k][j][i][37] * a[k-2][j+2][i-3]
+ W[k][j][i][38] * a[k-1][j+2][i-3]
+ W[k][j][i][39] * a[k][j+2][i-3]
+ W[k][j][i][40] * a[k+1][j+2][i-3]
+ W[k][j][i][41] * a[k+2][j+2][i-3]
+ W[k][j][i][42] * a[k+3][j+2][i-3]
+ W[k][j][i][43] * a[k-3][j+3][i-3]
+ W[k][j][i][44] * a[k-2][j+3][i-3]
+ W[k][j][i][45] * a[k-1][j+3][i-3]
+ W[k][j][i][46] * a[k][j+3][i-3]
+ W[k][j][i][47] * a[k+1][j+3][i-3]
+ W[k][j][i][48] * a[k+2][j+3][i-3]
+ W[k][j][i][49] * a[k+3][j+3][i-3]
+ W[k][j][i][50] * a[k-3][j-3][i-2]
+ W[k][j][i][51] * a[k-2][j-3][i-2]
+ W[k][j][i][52] * a[k-1][j-3][i-2]
+ W[k][j][i][53] * a[k][j-3][i-2]
+ W[k][j][i][54] * a[k+1][j-3][i-2]
+ W[k][j][i][55] * a[k+2][j-3][i-2]
+ W[k][j][i][56] * a[k+3][j-3][i-2]
+ W[k][j][i][57] * a[k-3][j-2][i-2]
+ W[k][j][i][58] * a[k-2][j-2][i-2]
+ W[k][j][i][59] * a[k-1][j-2][i-2]
+ W[k][j][i][60] * a[k][j-2][i-2]
+ W[k][j][i][61] * a[k+1][j-2][i-2]
+ W[k][j][i][62] * a[k+2][j-2][i-2]
+ W[k][j][i][63] * a[k+3][j-2][i-2]
+ W[k][j][i][64] * a[k-3][j-1][i-2]
+ W[k][j][i][65] * a[k-2][j-1][i-2]
+ W[k][j][i][66] * a[k-1][j-1][i-2]
+ W[k][j][i][67] * a[k][j-1][i-2]
+ W[k][j][i][68] * a[k+1][j-1][i-2]
+ W[k][j][i][69] * a[k+2][j-1][i-2]
+ W[k][j][i][70] * a[k+3][j-1][i-2]
+ W[k][j][i][71] * a[k-3][j][i-2]
+ W[k][j][i][72] * a[k-2][j][i-2]
+ W[k][j][i][73] * a[k-1][j][i-2]
+ W[k][j][i][74] * a[k][j][i-2]
+ W[k][j][i][75] * a[k+1][j][i-2]
+ W[k][j][i][76] * a[k+2][j][i-2]
+ W[k][j][i][77] * a[k+3][j][i-2]
+ W[k][j][i][78] * a[k-3][j+1][i-2]
+ W[k][j][i][79] * a[k-2][j+1][i-2]
+ W[k][j][i][80] * a[k-1][j+1][i-2]
+ W[k][j][i][81] * a[k][j+1][i-2]
+ W[k][j][i][82] * a[k+1][j+1][i-2]
+ W[k][j][i][83] * a[k+2][j+1][i-2]
+ W[k][j][i][84] * a[k+3][j+1][i-2]
+ W[k][j][i][85] * a[k-3][j+2][i-2]
+ W[k][j][i][86] * a[k-2][j+2][i-2]
+ W[k][j][i][87] * a[k-1][j+2][i-2]
+ W[k][j][i][88] * a[k][j+2][i-2]
+ W[k][j][i][89] * a[k+1][j+2][i-2]
+ W[k][j][i][90] * a[k+2][j+2][i-2]
+ W[k][j][i][91] * a[k+3][j+2][i-2]
+ W[k][j][i][92] * a[k-3][j+3][i-2]
+ W[k][j][i][93] * a[k-2][j+3][i-2]
+ W[k][j][i][94] * a[k-1][j+3][i-2]
+ W[k][j][i][95] * a[k][j+3][i-2]
+ W[k][j][i][96] * a[k+1][j+3][i-2]
+ W[k][j][i][97] * a[k+2][j+3][i-2]
+ W[k][j][i][98] * a[k+3][j+3][i-2]
+ W[k][j][i][99] * a[k-3][j-3][i-1]
+ W[k][j][i][100] * a[k-2][j-3][i-1]
+ W[k][j][i][101] * a[k-1][j-3][i-1]
+ W[k][j][i][102] * a[k][j-3][i-1]
+ W[k][j][i][103] * a[k+1][j-3][i-1]
+ W[k][j][i][104] * a[k+2][j-3][i-1]
+ W[k][j][i][105] * a[k+3][j-3][i-1]
+ W[k][j][i][106] * a[k-3][j-2][i-1]
+ W[k][j][i][107] * a[k-2][j-2][i-1]
+ W[k][j][i][108] * a[k-1][j-2][i-1]
+ W[k][j][i][109] * a[k][j-2][i-1]
+ W[k][j][i][110] * a[k+1][j-2][i-1]
+ W[k][j][i][111] * a[k+2][j-2][i-1]
+ W[k][j][i][112] * a[k+3][j-2][i-1]
+ W[k][j][i][113] * a[k-3][j-1][i-1]
+ W[k][j][i][114] * a[k-2][j-1][i-1]
+ W[k][j][i][115] * a[k-1][j-1][i-1]
+ W[k][j][i][116] * a[k][j-1][i-1]
+ W[k][j][i][117] * a[k+1][j-1][i-1]
+ W[k][j][i][118] * a[k+2][j-1][i-1]
+ W[k][j][i][119] * a[k+3][j-1][i-1]
+ W[k][j][i][120] * a[k-3][j][i-1]
+ W[k][j][i][121] * a[k-2][j][i-1]
+ W[k][j][i][122] * a[k-1][j][i-1]
+ W[k][j][i][123] * a[k][j][i-1]
+ W[k][j][i][124] * a[k+1][j][i-1]
+ W[k][j][i][125] * a[k+2][j][i-1]
+ W[k][j][i][126] * a[k+3][j][i-1]
+ W[k][j][i][127] * a[k-3][j+1][i-1]
+ W[k][j][i][128] * a[k-2][j+1][i-1]
+ W[k][j][i][129] * a[k-1][j+1][i-1]
+ W[k][j][i][130] * a[k][j+1][i-1]
+ W[k][j][i][131] * a[k+1][j+1][i-1]
+ W[k][j][i][132] * a[k+2][j+1][i-1]
+ W[k][j][i][133] * a[k+3][j+1][i-1]
+ W[k][j][i][134] * a[k-3][j+2][i-1]
+ W[k][j][i][135] * a[k-2][j+2][i-1]
+ W[k][j][i][136] * a[k-1][j+2][i-1]
+ W[k][j][i][137] * a[k][j+2][i-1]
+ W[k][j][i][138] * a[k+1][j+2][i-1]
+ W[k][j][i][139] * a[k+2][j+2][i-1]
+ W[k][j][i][140] * a[k+3][j+2][i-1]
+ W[k][j][i][141] * a[k-3][j+3][i-1]
+ W[k][j][i][142] * a[k-2][j+3][i-1]
+ W[k][j][i][143] * a[k-1][j+3][i-1]
+ W[k][j][i][144] * a[k][j+3][i-1]
+ W[k][j][i][145] * a[k+1][j+3][i-1]
+ W[k][j][i][146] * a[k+2][j+3][i-1]
+ W[k][j][i][147] * a[k+3][j+3][i-1]
+ W[k][j][i][148] * a[k-3][j-3][i]
+ W[k][j][i][149] * a[k-2][j-3][i]
+ W[k][j][i][150] * a[k-1][j-3][i]
+ W[k][j][i][151] * a[k][j-3][i]
+ W[k][j][i][152] * a[k+1][j-3][i]
+ W[k][j][i][153] * a[k+2][j-3][i]
+ W[k][j][i][154] * a[k+3][j-3][i]
+ W[k][j][i][155] * a[k-3][j-2][i]
+ W[k][j][i][156] * a[k-2][j-2][i]
+ W[k][j][i][157] * a[k-1][j-2][i]
+ W[k][j][i][158] * a[k][j-2][i]
+ W[k][j][i][159] * a[k+1][j-2][i]
+ W[k][j][i][160] * a[k+2][j-2][i]
+ W[k][j][i][161] * a[k+3][j-2][i]
+ W[k][j][i][162] * a[k-3][j-1][i]
+ W[k][j][i][163] * a[k-2][j-1][i]
+ W[k][j][i][164] * a[k-1][j-1][i]
+ W[k][j][i][165] * a[k][j-1][i]
+ W[k][j][i][166] * a[k+1][j-1][i]
+ W[k][j][i][167] * a[k+2][j-1][i]
+ W[k][j][i][168] * a[k+3][j-1][i]
+ W[k][j][i][169] * a[k-3][j][i]
+ W[k][j][i][170] * a[k-2][j][i]
+ W[k][j][i][171] * a[k-1][j][i]
+ W[k][j][i][172] * a[k+1][j][i]
+ W[k][j][i][173] * a[k+2][j][i]
+ W[k][j][i][174] * a[k+3][j][i]
+ W[k][j][i][175] * a[k-3][j+1][i]
+ W[k][j][i][176] * a[k-2][j+1][i]
+ W[k][j][i][177] * a[k-1][j+1][i]
+ W[k][j][i][178] * a[k][j+1][i]
+ W[k][j][i][179] * a[k+1][j+1][i]
+ W[k][j][i][180] * a[k+2][j+1][i]
+ W[k][j][i][181] * a[k+3][j+1][i]
+ W[k][j][i][182] * a[k-3][j+2][i]
+ W[k][j][i][183] * a[k-2][j+2][i]
+ W[k][j][i][184] * a[k-1][j+2][i]
+ W[k][j][i][185] * a[k][j+2][i]
+ W[k][j][i][186] * a[k+1][j+2][i]
+ W[k][j][i][187] * a[k+2][j+2][i]
+ W[k][j][i][188] * a[k+3][j+2][i]
+ W[k][j][i][189] * a[k-3][j+3][i]
+ W[k][j][i][190] * a[k-2][j+3][i]
+ W[k][j][i][191] * a[k-1][j+3][i]
+ W[k][j][i][192] * a[k][j+3][i]
+ W[k][j][i][193] * a[k+1][j+3][i]
+ W[k][j][i][194] * a[k+2][j+3][i]
+ W[k][j][i][195] * a[k+3][j+3][i]
+ W[k][j][i][196] * a[k-3][j-3][i+1]
+ W[k][j][i][197] * a[k-2][j-3][i+1]
+ W[k][j][i][198] * a[k-1][j-3][i+1]
+ W[k][j][i][199] * a[k][j-3][i+1]
+ W[k][j][i][200] * a[k+1][j-3][i+1]
+ W[k][j][i][201] * a[k+2][j-3][i+1]
+ W[k][j][i][202] * a[k+3][j-3][i+1]
+ W[k][j][i][203] * a[k-3][j-2][i+1]
+ W[k][j][i][204] * a[k-2][j-2][i+1]
+ W[k][j][i][205] * a[k-1][j-2][i+1]
+ W[k][j][i][206] * a[k][j-2][i+1]
+ W[k][j][i][207] * a[k+1][j-2][i+1]
+ W[k][j][i][208] * a[k+2][j-2][i+1]
+ W[k][j][i][209] * a[k+3][j-2][i+1]
+ W[k][j][i][210] * a[k-3][j-1][i+1]
+ W[k][j][i][211] * a[k-2][j-1][i+1]
+ W[k][j][i][212] * a[k-1][j-1][i+1]
+ W[k][j][i][213] * a[k][j-1][i+1]
+ W[k][j][i][214] * a[k+1][j-1][i+1]
+ W[k][j][i][215] * a[k+2][j-1][i+1]
+ W[k][j][i][216] * a[k+3][j-1][i+1]
+ W[k][j][i][217] * a[k-3][j][i+1]
+ W[k][j][i][218] * a[k-2][j][i+1]
+ W[k][j][i][219] * a[k-1][j][i+1]
+ W[k][j][i][220] * a[k][j][i+1]
+ W[k][j][i][221] * a[k+1][j][i+1]
+ W[k][j][i][222] * a[k+2][j][i+1]
+ W[k][j][i][223] * a[k+3][j][i+1]
+ W[k][j][i][224] * a[k-3][j+1][i+1]
+ W[k][j][i][225] * a[k-2][j+1][i+1]
+ W[k][j][i][226] * a[k-1][j+1][i+1]
+ W[k][j][i][227] * a[k][j+1][i+1]
+ W[k][j][i][228] * a[k+1][j+1][i+1]
+ W[k][j][i][229] * a[k+2][j+1][i+1]
+ W[k][j][i][230] * a[k+3][j+1][i+1]
+ W[k][j][i][231] * a[k-3][j+2][i+1]
+ W[k][j][i][232] * a[k-2][j+2][i+1]
+ W[k][j][i][233] * a[k-1][j+2][i+1]
+ W[k][j][i][234] * a[k][j+2][i+1]
+ W[k][j][i][235] * a[k+1][j+2][i+1]
+ W[k][j][i][236] * a[k+2][j+2][i+1]
+ W[k][j][i][237] * a[k+3][j+2][i+1]
+ W[k][j][i][238] * a[k-3][j+3][i+1]
+ W[k][j][i][239] * a[k-2][j+3][i+1]
+ W[k][j][i][240] * a[k-1][j+3][i+1]
+ W[k][j][i][241] * a[k][j+3][i+1]
+ W[k][j][i][242] * a[k+1][j+3][i+1]
+ W[k][j][i][243] * a[k+2][j+3][i+1]
+ W[k][j][i][244] * a[k+3][j+3][i+1]
+ W[k][j][i][245] * a[k-3][j-3][i+2]
+ W[k][j][i][246] * a[k-2][j-3][i+2]
+ W[k][j][i][247] * a[k-1][j-3][i+2]
+ W[k][j][i][248] * a[k][j-3][i+2]
+ W[k][j][i][249] * a[k+1][j-3][i+2]
+ W[k][j][i][250] * a[k+2][j-3][i+2]
+ W[k][j][i][251] * a[k+3][j-3][i+2]
+ W[k][j][i][252] * a[k-3][j-2][i+2]
+ W[k][j][i][253] * a[k-2][j-2][i+2]
+ W[k][j][i][254] * a[k-1][j-2][i+2]
+ W[k][j][i][255] * a[k][j-2][i+2]
+ W[k][j][i][256] * a[k+1][j-2][i+2]
+ W[k][j][i][257] * a[k+2][j-2][i+2]
+ W[k][j][i][258] * a[k+3][j-2][i+2]
+ W[k][j][i][259] * a[k-3][j-1][i+2]
+ W[k][j][i][260] * a[k-2][j-1][i+2]
+ W[k][j][i][261] * a[k-1][j-1][i+2]
+ W[k][j][i][262] * a[k][j-1][i+2]
+ W[k][j][i][263] * a[k+1][j-1][i+2]
+ W[k][j][i][264] * a[k+2][j-1][i+2]
+ W[k][j][i][265] * a[k+3][j-1][i+2]
+ W[k][j][i][266] * a[k-3][j][i+2]
+ W[k][j][i][267] * a[k-2][j][i+2]
+ W[k][j][i][268] * a[k-1][j][i+2]
+ W[k][j][i][269] * a[k][j][i+2]
+ W[k][j][i][270] * a[k+1][j][i+2]
+ W[k][j][i][271] * a[k+2][j][i+2]
+ W[k][j][i][272] * a[k+3][j][i+2]
+ W[k][j][i][273] * a[k-3][j+1][i+2]
+ W[k][j][i][274] * a[k-2][j+1][i+2]
+ W[k][j][i][275] * a[k-1][j+1][i+2]
+ W[k][j][i][276] * a[k][j+1][i+2]
+ W[k][j][i][277] * a[k+1][j+1][i+2]
+ W[k][j][i][278] * a[k+2][j+1][i+2]
+ W[k][j][i][279] * a[k+3][j+1][i+2]
+ W[k][j][i][280] * a[k-3][j+2][i+2]
+ W[k][j][i][281] * a[k-2][j+2][i+2]
+ W[k][j][i][282] * a[k-1][j+2][i+2]
+ W[k][j][i][283] * a[k][j+2][i+2]
+ W[k][j][i][284] * a[k+1][j+2][i+2]
+ W[k][j][i][285] * a[k+2][j+2][i+2]
+ W[k][j][i][286] * a[k+3][j+2][i+2]
+ W[k][j][i][287] * a[k-3][j+3][i+2]
+ W[k][j][i][288] * a[k-2][j+3][i+2]
+ W[k][j][i][289] * a[k-1][j+3][i+2]
+ W[k][j][i][290] * a[k][j+3][i+2]
+ W[k][j][i][291] * a[k+1][j+3][i+2]
+ W[k][j][i][292] * a[k+2][j+3][i+2]
+ W[k][j][i][293] * a[k+3][j+3][i+2]
+ W[k][j][i][294] * a[k-3][j-3][i+3]
+ W[k][j][i][295] * a[k-2][j-3][i+3]
+ W[k][j][i][296] * a[k-1][j-3][i+3]
+ W[k][j][i][297] * a[k][j-3][i+3]
+ W[k][j][i][298] * a[k+1][j-3][i+3]
+ W[k][j][i][299] * a[k+2][j-3][i+3]
+ W[k][j][i][300] * a[k+3][j-3][i+3]
+ W[k][j][i][301] * a[k-3][j-2][i+3]
+ W[k][j][i][302] * a[k-2][j-2][i+3]
+ W[k][j][i][303] * a[k-1][j-2][i+3]
+ W[k][j][i][304] * a[k][j-2][i+3]
+ W[k][j][i][305] * a[k+1][j-2][i+3]
+ W[k][j][i][306] * a[k+2][j-2][i+3]
+ W[k][j][i][307] * a[k+3][j-2][i+3]
+ W[k][j][i][308] * a[k-3][j-1][i+3]
+ W[k][j][i][309] * a[k-2][j-1][i+3]
+ W[k][j][i][310] * a[k-1][j-1][i+3]
+ W[k][j][i][311] * a[k][j-1][i+3]
+ W[k][j][i][312] * a[k+1][j-1][i+3]
+ W[k][j][i][313] * a[k+2][j-1][i+3]
+ W[k][j][i][314] * a[k+3][j-1][i+3]
+ W[k][j][i][315] * a[k-3][j][i+3]
+ W[k][j][i][316] * a[k-2][j][i+3]
+ W[k][j][i][317] * a[k-1][j][i+3]
+ W[k][j][i][318] * a[k][j][i+3]
+ W[k][j][i][319] * a[k+1][j][i+3]
+ W[k][j][i][320] * a[k+2][j][i+3]
+ W[k][j][i][321] * a[k+3][j][i+3]
+ W[k][j][i][322] * a[k-3][j+1][i+3]
+ W[k][j][i][323] * a[k-2][j+1][i+3]
+ W[k][j][i][324] * a[k-1][j+1][i+3]
+ W[k][j][i][325] * a[k][j+1][i+3]
+ W[k][j][i][326] * a[k+1][j+1][i+3]
+ W[k][j][i][327] * a[k+2][j+1][i+3]
+ W[k][j][i][328] * a[k+3][j+1][i+3]
+ W[k][j][i][329] * a[k-3][j+2][i+3]
+ W[k][j][i][330] * a[k-2][j+2][i+3]
+ W[k][j][i][331] * a[k-1][j+2][i+3]
+ W[k][j][i][332] * a[k][j+2][i+3]
+ W[k][j][i][333] * a[k+1][j+2][i+3]
+ W[k][j][i][334] * a[k+2][j+2][i+3]
+ W[k][j][i][335] * a[k+3][j+2][i+3]
+ W[k][j][i][336] * a[k-3][j+3][i+3]
+ W[k][j][i][337] * a[k-2][j+3][i+3]
+ W[k][j][i][338] * a[k-1][j+3][i+3]
+ W[k][j][i][339] * a[k][j+3][i+3]
+ W[k][j][i][340] * a[k+1][j+3][i+3]
+ W[k][j][i][341] * a[k+2][j+3][i+3]
+ W[k][j][i][342] * a[k+3][j+3][i+3]
;
}
}
}
